const nbRows = 32;
const nbCols = 32;
const nbPhases = 8;

const malware = new Malware("#overlay", {
  nbRows,
  nbCols,
  nbPhases,
  onEnd: () => {
    const endAnimationContainer = document.querySelector(".malwareEnd");
    const filledArray = document.querySelectorAll(".filled");
    filledArray.forEach((filled) => {
      filled.style.backgroundColor = "#000000da";
    });

    const animationAudio = document.querySelector("audio");
    endAnimationContainer.classList.add("malwareEnd-active");
    animationAudio.play();

    setTimeout(() => {
      // Stop and reset the music
      animationAudio.pause();
      animationAudio.currentTime = 0;
      // Remove the end animation
      endAnimationContainer.classList.remove("malwareEnd-active");
      // Reset malware
      const divEnd = document.createElement("div");
      divEnd.className = "end";
      divEnd.innerHTML = endAnimationContainer.innerHTML;
      malware.reset(); // l'overlay est vidé de tout, même les composants d'animation !!

      document.querySelector("#overlay").prepend(divEnd); // rebuild... he he he
    }, 20000);
  },
});

const handleFillCell = (count) => {
  console.log("malware client");
  for (let i = 0; i < count; i++) {
    malware.fillCell();
  }
};

malware.init();

socket.on("malware", handleFillCell);
